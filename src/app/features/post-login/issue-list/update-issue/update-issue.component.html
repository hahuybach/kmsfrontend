<!-- <span>breadcrumb here</span> -->
<!-- {{ issue | json }} -->
<h4>Cập nhật kế hoạch kiểm tra</h4>
<br />
<form class="row issue-content no-gutter-row" *ngIf="issue">
  <p-toast></p-toast>
  <p-confirmDialog [style]="{ width: '50vw' }"></p-confirmDialog>
  <p-dialog
    header="Danh sách đoàn kiểm tra"
    [(visible)]="popupVisible"
    [modal]="true"
    [style]="{ width: '80vw' }"
    [draggable]="false"
    [resizable]="false"
  >
    <p-table
      #dt
      [value]="inspectorLeftList"
      [(selection)]="selectedInspectors"
      dataKey="id"
      [rowHover]="true"
      [rows]="5"
      [showCurrentPageReport]="true"
      [paginator]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [filterDelay]="0"
      [globalFilterFields]="['name', 'role', 'school']"
    >
      <ng-template pTemplate="caption">
        <div class="table-header">
          <span class="p-input-icon-left">
            <i class="fa-solid fa-search"></i>
            <input
              pInputText
              type="text"
              (input)="dt.filterGlobal($any($event.target).value, 'contains')"
              placeholder="Tìm kiếm"
            />
          </span>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 4rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th class="th-id">
            <div>Id</div>
          </th>
          <th pSortableColumn="name">
            <div>
              Tên
              <p-sortIcon field="name"></p-sortIcon>
            </div>
          </th>
          <th pSortableColumn="role">
            <div>
              Chức vụ
              <p-sortIcon field="role"></p-sortIcon>
            </div>
          </th>
          <th pSortableColumn="school">
            <div>
              Tên trường
              <p-sortIcon field="school"></p-sortIcon>
            </div>
          </th>
          <!-- <th class="th-small"></th> -->
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-inspector>
        <tr class="p-selectable-row">
          <td>
            <p-tableCheckbox [value]="inspector"></p-tableCheckbox>
          </td>
          <td>
            <span class="p-column-title">Id</span>
            {{ inspector.id }}
          </td>
          <td>
            <span class="p-column-title">Tên</span>
            {{ inspector.name }}
          </td>
          <td>
            <span class="p-column-title">Chức vụ</span>
            {{ inspector.address.city }}
          </td>
          <td>
            <span class="p-column-title">Đơn vị</span>
            {{ inspector.company.name }}
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">Không tìm thấy người nào</td>
        </tr>
      </ng-template>
    </p-table>
    <button
      pButton
      (click)="addInspector()"
      [disabled]="!selectedInspectors || !selectedInspectors.length"
    >
      Lưu
    </button>
  </p-dialog>
  <p-dialog
    header="Cập nhật tài liệu"
    [(visible)]="uploadFileVisible"
    [modal]="true"
    [style]="{ width: '50vw' }"
    [draggable]="false"
    [resizable]="false"
  >
    <p-fileUpload
      name="demo[]"
      url="https://www.primefaces.org/cdn/api/upload.php"
      (onUpload)="onUpload($any($event))"
      [multiple]="false"
      accept="application/pdf"
    >
      <ng-template pTemplate="content" class="file-upload-content">
        <ul *ngIf="uploadedFiles.length">
          <li *ngFor="let file of uploadedFiles">
            {{ file.name }} - {{ file.size }} bytes
          </li>
        </ul>
      </ng-template>
    </p-fileUpload>
  </p-dialog>
  <div class="col-md-8">
    <div class="mb-2 issue-name">
      <h5>Tên kế hoạch</h5>
      <input
        pInputText
        class="text-black-50 w-100"
        value="{{ issue.docName }}"
        formControlName="name"
      />
    </div>
    <div class="mb-2 issue-description">
      <h5>Chi tiết</h5>
      <textarea
        pInputTextarea
        class="text-black-50 w-100"
        value="{{ issue.description }}"
        rows="3"
        formControlName="description"
      ></textarea>
    </div>
    <div class="mb-5">
      <h5 class="mb-3">Tài liệu công văn</h5>
      <ng-container *ngFor="let item of issue.file">
        <div class="mb-2">
          <div class="file-item p-3 d-flex">
            <div
              class="file-item-icon d-flex justify-content-center align-items-center"
            >
              <i class="fa-regular fa-file"></i>
            </div>
            <div class="file-item-content ps-3">
              <p class="text-d">
                {{ item.name }}
              </p>
              {{ item.size }}
            </div>
            <div
              class="mx-auto d-flex justify-content-center align-items-center"
            >
              <p-tag
                class="status"
                [severity]="item.status ? 'success' : 'danger'"
                [rounded]="true"
              >
                {{ item.status ? "Có hiệu lực" : "Không có hiệu lực" }}
              </p-tag>
            </div>

            <div
              class="update-icon d-flex justify-content-center align-items-center"
            >
              <i
                class="bi bi-pencil-square"
                (click)="togglePopupFileUpload()"
              ></i>
            </div>
          </div>
        </div>
      </ng-container>
      <!-- <button type="button" pButton>Thêm mới</button> -->
      <!-- <br /> -->
      <button pButton>Lưu</button>
    </div>
  </div>
  <div class="col-md-4">
    <div class="list-inspector">
      <div class="list-inspector-header p-3 text-center">
        <h5 class="mx-auto">Danh sách thanh tra</h5>
        <div class="total">
          <span class="text-secondary mx-auto"
            >Tổng số: {{ issue.inspector.length }}</span
          >
          <div *ngIf="isChanged"></div>
        </div>
      </div>

      <div class="card">
        <ng-template pTemplate="header">Header Content</ng-template>
        <p-virtualScroller
          [value]="issue.inspector"
          class="border-1 surface-border border-round"
          scrollHeight="540px"
          [itemSize]="120"
        >
          <ng-template pTemplate="item" let-item>
            <div class="scrollview-item d-flex p-3 ms-2 h-full">
              <div
                class="scrollview-item-icon d-flex justify-content-center align-items-center"
              >
                <i class="fa fa-user-circle" aria-hidden="true"></i>
                <!-- <span class="index">{{
                  issue.inspector.indexOf(item) + 1
                }}</span> -->
              </div>
              <div class="scrollview-item-content ms-4">
                <span class="font-weight-bold">{{ item.name }}</span>
                <br />
                <span
                  >{{ item.role }}<br />
                  {{ item.school }}
                </span>
              </div>

              <div
                class="trash-icon ml-5 d-flex justify-content-center align-items-center"
              >
                <i
                  *ngIf="isChanged"
                  class="fa-solid fa-trash"
                  (click)="confirmDelete(item)"
                ></i>
              </div>
            </div>
          </ng-template>
        </p-virtualScroller>
      </div>
      <div class="bottom p-2">
        <div
          class="bottom-item d-flex justify-content-center"
          *ngIf="!isChanged"
        >
          <button pButton (click)="toggleStatus()">Thay đổi</button>
        </div>
        <div
          class="bottom-item d-flex justify-content-between"
          *ngIf="isChanged"
        >
          <button pButton class="cancel" (click)="toggleCancel()">Hủy</button>
          <button pButton type="button" (click)="showInspectorPopup()">
            <i class="bi bi-plus-lg"></i>
          </button>
          <button pButton (click)="toggleStore()">Lưu</button>
        </div>
      </div>
    </div>
  </div>
</form>
